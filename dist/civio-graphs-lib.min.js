// civio-graphs-lib v0.1.3 Copyright 2019 Raúl Díaz Poblete
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("d3-array"),require("d3-selection"),require("d3-axis"),require("d3-format"),require("d3-scale"),require("d3-time"),require("d3-time-format"),require("lodash"),require("d3-shape"),require("d3-hierarchy"),require("d3-scale-chromatic")):"function"==typeof define&&define.amd?define(["exports","d3-array","d3-selection","d3-axis","d3-format","d3-scale","d3-time","d3-time-format","lodash","d3-shape","d3-hierarchy","d3-scale-chromatic"],e):e(t["civio-graphs-lib"]=t["civio-graphs-lib"]||{},t.d3Array,t.d3Selection,t.d3Axis,t.d3Format,t.d3Scale,t.d3Time,t.d3TimeFormat,t.lodash,t.d3Shape,t.d3Hierarchy,t.d3ScaleChromatic)}(this,function(t,e,i,s,r,a,n,h,o,l,c,d){"use strict";function u(){let t,s,r,a,n=0;function h(){}return h.setup=function(e){return t=(s=e).el.select(".tooltip"),h},h.render=function(){return!t||t.empty()?h:(a=e.bisector(s.x).left,r=s.chart.append("circle").attr("class","tooltip-point").attr("display","none").attr("r",4),s.chart.on("mousemove",h.onMouseMove).on("mouseenter",h.onMouseEnter).on("mouseleave",h.onMouseLeave),h)},h.show=function(){return t.style("opacity",1),r.attr("display",null),h},h.hide=function(){return t.style("opacity",0),r.attr("display","none"),h},h.setPosition=function(e){const{x:i,y:a}=h.getPosition(e),n=i>s.width/2;return r.attr("transform",`translate(${i}, ${a})`),t.style("left",n?"auto":`${i}px`).style("right",n?`${s.width-i}px`:"auto").style("top",`${a}px`).classed("right",n),h},h.setContent=function(e,i){t.select(".label.x").html(s.tooltipFormatX()(e)),t.select(".label.y").html(s.tooltipFormatY()(i))},h.onMouseMove=function(){const t=h.getMouseData(i.event.layerX);return n!==t&&(n=t,h.setPosition(n),h.setContent(s.x(n),s.y(n))),h},h.onMouseEnter=function(){return h.show(),h},h.onMouseLeave=function(){return h.hide(),h},h.getPosition=function(t){const e=a(s.data,s.x(t)),i=e<s.data.length?s.data[e]:s.data[s.data.length-1];return{x:s.scaleX(s.x(i)),y:s.scaleY(s.y(i))}},h.getMouseData=function(t){const e=s.scaleX.invert(t),i=a(s.data,e,1),r=s.data[i-1],n=s.data[i];return n&&e-s.x(r)>s.x(n)-e?n:r},h}const m={aspectRatio:16/9,height:null,lang:"es",margin:{top:0,right:0,left:0,bottom:0},axis:{x:!0,y:!0}};class g{constructor(t,e){if(this.el=i.select(t),0===this.el.size())throw new Error(`Can't find root element width ${t} selector`);this.config=o.defaultsDeep(e,m),this.width=0,this.setChart(),this.setTooltip()}setChart(){return this.chart=this.el.append("svg"),this}setTooltip(){this.tooltip=u().setup(this)}setFormat(){r.formatDefaultLocale({decimal:"es"===this.config.lang?",":".",thousands:"es"===this.config.lang?".":",",grouping:[3],currency:this.currencyFormat()}),"es"===this.config.lang&&h.timeFormatDefaultLocale({dateTime:"%A, %e de %B de %Y, %X",date:"%d/%m/%Y",time:"%H:%M:%S",periods:["AM","PM"],days:["domingo","lunes","martes","miércoles","jueves","viernes","sábado"],shortDays:["dom","lun","mar","mié","jue","vie","sáb"],months:["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"],shortMonths:["ene","feb","mar","abr","may","jun","jul","ago","sep","oct","nov","dic"]})}setScales(){return this.scaleX=this.getScaleX().domain(this.scaleXDomain()).range(this.scaleXRange()),this.scaleY=this.getScaleY().domain(this.scaleYDomain()).nice().range(this.scaleYRange()),this}setAxis(){return this.config.axis.x&&(this.axisX=(t=>t.attr("class","x axis").attr("transform",`translate(0,${this.height-this.config.margin.bottom})`).call(this.axisRendererX()).call(t=>t.selectAll(".tick line").attr("y1",-this.height+this.config.margin.top+this.config.margin.bottom).attr("y2",0)))),this.config.axis.y&&(this.axisY=(t=>t.attr("class","y axis").attr("transform",`translate(${this.config.margin.left},0)`).call(this.axisRendererY()).call(t=>t.selectAll(".tick line").attr("x1",0).attr("x2",this.width-this.config.margin.left-this.config.margin.right)))),this}setRenderer(){return this}setup(t){return this.data=t,this.setFormat(),this.onResize(),this.setScales(),this.setAxis(),this.setRenderer(),this}render(){return this.config.axis.x&&this.chart.append("g").call(this.axisX),this.config.axis.y&&this.chart.append("g").call(this.axisY),this.tooltip.render(),this.setResize(),this}clear(){(this.config.axis.x||this.config.axis.y)&&this.chart.selectAll("g").remove()}setResize(){return window.addEventListener("resize",o.debounce(()=>this.onResize(),150)),this}onResize(){let t=this.el.node().offsetWidth;t!==this.width&&(this.width=t,this.height=this.config.height?this.config.height:Math.round(this.width/this.config.aspectRatio),this.resize())}resize(){return this.chart.attr("width",this.width).attr("height",this.height),this.scaleX&&this.scaleX.range(this.scaleXRange()),this.scaleY&&this.scaleY.range(this.scaleYRange()),this.axisX&&i.select(".x.axis").call(this.axisX),this.axisY&&i.select(".y.axis").call(this.axisY),this}x(t){return t.date}y(t){return t.value}axisRendererX(){return s.axisBottom(this.scaleX).tickSizeOuter(0).tickFormat(this.axisFormatX()).ticks(n.timeYear)}axisRendererY(){return s.axisLeft(this.scaleY).tickFormat(this.axisFormatY()).ticks(this.height/80)}axisFormatX(){return h.timeFormat("%Y")}axisFormatY(){return r.format("d")}tooltipFormatX(){return h.timeFormat("es"===this.config.lang?"%d %B, %Y":"%B %d, %Y")}tooltipFormatY(){return r.format("$,.1f")}currencyFormat(){return[""," €"]}getScaleX(){return a.scaleTime()}getScaleY(){return a.scaleLinear()}scaleXDomain(){return[this.x(this.data[0]),this.x(this.data[this.data.length-1])]}scaleYDomain(){return e.extent(this.data,this.y)}scaleXRange(){return[this.config.margin.left,this.width-this.config.margin.right]}scaleYRange(){return[this.height-this.config.margin.bottom,this.config.margin.top]}}class p extends g{setRenderer(){return this.lineRenderer=l.line().defined(t=>!isNaN(this.y(t))).x(t=>this.scaleX(this.x(t))).y(t=>this.scaleY(this.y(t))),this}render(){return super.render(),this.line=this.chart.append("path").datum(this.data).attr("class","line").attr("d",this.lineRenderer),this}clear(){return super.clear(),this.chart.selectAll("path").remove(),this}resize(){return super.resize(),this.line&&this.line.attr("d",this.lineRenderer),this}curve(t){return this.lineRenderer.curve(t),this}}t.Chart=g,t.AreaChart=class extends p{setRenderer(){return super.setRenderer(),this.areaRenderer=l.area().x(t=>this.scaleX(this.x(t))).y0(this.getAreaRendererY0()).y1(t=>this.scaleY(this.y(t))),this}render(){return super.render(),this.area=this.chart.append("path").datum(this.data).attr("class","area").attr("d",this.areaRenderer),this}resize(){return super.resize(),this.areaRenderer&&this.areaRenderer.y0(this.getAreaRendererY0()),this.area&&this.area.attr("d",this.areaRenderer),this}curve(t){return super.curve(t),this.areaRenderer.curve(t),this}getAreaRendererY0(){return this.height-this.config.margin.bottom}},t.LineChart=p,t.TreemapChart=class extends g{setChart(){return this.chart=this.el.append("div"),this}setTooltip(){}setScales(){return this.treemap=c.treemap().size([this.width,this.height]).round(!0),this.scaleColor=this.getScaleColor(),this}setAxis(){return this}render(){return this.setResize(),this.renderNodes(),this}renderNodes(){this.nodes=this.chart.selectAll("div").data(this.treemap(this.data).leaves()).enter().append("div").attr("class",this.getNodeClass).style("background",t=>this.getNodeColor(t)).call(t=>this.setNodeDimension(t)).call(t=>this.setNodeTooltip(t)).append("span").html(this.getNodeTitle)}clear(){return super.clear(),this.chart.selectAll("div").remove(),this}resize(){return this.treemap&&(this.treemap.size([this.width,this.height]),this.clear(),this.renderNodes()),this}setNodeDimension(t){t.style("top",t=>`${t.y0}px`).style("left",t=>`${100*t.x0/this.width}%`).style("width",t=>`${100*(t.x1-t.x0)/this.width}%`).style("height",t=>`${t.y1-t.y0}px`)}setNodeTooltip(t){t.attr("data-toggle","tooltip").attr("data-html","true").attr("title",t=>this.getNodeTooltipContent(t))}x(t){return t.data.name}y(t){return t.data.value}getScaleColor(){return a.scaleOrdinal().range(d.schemeCategory10)}getNodeClass(){return"treemap-node"}getNodeColor(t){for(;t.depth>1;)t=t.parent;return this.scaleColor(this.x(t))}getNodeTitle(t){return this.x(t)}getNodeTooltipContent(t){return`<strong>${this.x(t)}</strong><br/>${this.tooltipFormatY()(this.y(t))}`}tile(t){return this.treemap.tile(t),this}},t.tooltip=u,Object.defineProperty(t,"__esModule",{value:!0})});
