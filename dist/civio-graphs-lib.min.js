// civio-graphs-lib v0.1.3 Copyright 2019 Raúl Díaz Poblete
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("d3-array"),require("d3-selection"),require("d3-axis"),require("d3-format"),require("d3-scale"),require("d3-time"),require("d3-time-format"),require("lodash")):"function"==typeof define&&define.amd?define(["exports","d3-array","d3-selection","d3-axis","d3-format","d3-scale","d3-time","d3-time-format","lodash"],e):e(t["civio-graphs-lib"]=t["civio-graphs-lib"]||{},t.d3Array,t.d3Selection,t.d3Axis,t.d3Format,t.d3Scale,t.d3Time,t.d3TimeFormat,t.lodash)}(this,function(t,e,i,s,a,r,n,o,h){"use strict";const c={aspectRatio:16/9,height:null,lang:"es",margin:{top:0,right:0,left:0,bottom:0},axis:{x:!0,y:!0},format:{x:null,y:null,currency:[""," €"]}};t.Chart=class{constructor(t,e){this.el=i.select(t),this.config=h.defaultsDeep(e,c),this.width=0,a.formatDefaultLocale({decimal:"es"===this.config.lang?",":".",thousands:"es"===this.config.lang?".":",",currency:this.config.format.currency}),this.config.format.x=o.timeFormat("%B %d, %Y"),this.config.format.y=a.format("$,.1f"),this.x=(t=>t.date),this.y=(t=>t.value),this.setChart(),this.setTooltip()}setChart(){return this.chart=this.el.append("svg"),this}setTooltip(){this.tooltip=function(){let t,s,a,r,n=0;function o(){}return o.setup=function(e){return t=(s=e).el.select(".tooltip"),o},o.render=function(){return!t||t.empty()?o:(r=e.bisector(s.x).left,a=s.chart.append("circle").attr("class","tooltip-point").attr("display","none").attr("r",4),s.chart.on("mousemove",o.onMouseMove).on("mouseenter",o.onMouseEnter).on("mouseleave",o.onMouseLeave),o)},o.setPosition=function(e,i){const r=e>s.width/2;return a.attr("transform",`translate(${e}, ${i})`),t.style("left",r?"auto":`${e}px`).style("right",r?`${s.width-e}px`:"auto").style("top",`${i}px`).classed("right",r),o},o.setContent=function(e,i){t.select(".label.x").html(s.config.format.x(e)),t.select(".label.y").html(s.config.format.y(i))},o.onMouseMove=function(){const t=o.getMouseData(i.event.layerX);return n!==t&&(n=t,o.setPosition(o.getPositionX(n),o.getPositionY(n)),o.setContent(s.x(n),s.y(n))),o},o.onMouseEnter=function(){return t.style("opacity",1),a.attr("display",null),o},o.onMouseLeave=function(){return t.style("opacity",0),a.attr("display","none"),o},o.getPositionX=function(t){return s.scaleX(s.x(t))},o.getPositionY=function(t){return s.scaleY(s.y(t))},o.getMouseData=function(t){const e=s.scaleX.invert(t),i=r(s.data,e,1),a=s.data[i-1],n=s.data[i];return n&&e-s.x(a)>s.x(n)-e?n:a},o}().setup(this)}setScales(){return this.scaleX=r.scaleUtc().domain(this.scaleXDomain()).range(this.scaleXRange()),this.scaleY=r.scaleLinear().domain(this.scaleYDomain()).nice().range(this.scaleYRange()),this}setAxis(){return this.config.axis.x&&(this.axisX=(t=>t.attr("class","x axis").attr("transform",`translate(0,${this.height-this.config.margin.bottom})`).call(this.axisRendererX()).call(t=>t.selectAll(".tick line").attr("y1",-this.height+this.config.margin.top+this.config.margin.bottom).attr("y2",0)))),this.config.axis.y&&(this.axisY=(t=>t.attr("class","y axis").attr("transform",`translate(${this.config.margin.left},0)`).call(this.axisRendererY()).call(t=>t.selectAll(".tick line").attr("x1",0).attr("x2",this.width-this.config.margin.left-this.config.margin.right)))),this}setRenderer(){return this}setup(t){return this.data=t,this.onResize(),this.setScales(),this.setAxis(),this.setRenderer(),this}render(){return this.config.axis.x&&this.chart.append("g").call(this.axisX),this.config.axis.y&&this.chart.append("g").call(this.axisY),this.tooltip.render(),this.setResize(),this}setResize(){return window.addEventListener("resize",h.debounce(()=>this.onResize(),150)),this}onResize(){let t=this.el.node().offsetWidth;t!==this.width&&(this.width=t,this.height=this.config.height?this.config.height:Math.round(this.width/this.config.aspectRatio),this.resize())}resize(){return this.chart.attr("width",this.width).attr("height",this.height),this.scaleX&&this.scaleX.range(this.scaleXRange()),this.scaleY&&this.scaleY.range(this.scaleYRange()),this.axisX&&i.select(".x.axis").call(this.axisX),this.axisY&&i.select(".y.axis").call(this.axisY),this}axisRendererX(){return s.axisBottom(this.scaleX).tickSizeOuter(0).tickFormat(this.axisFormatX()).ticks(n.timeYear)}axisRendererY(){return s.axisLeft(this.scaleY).tickFormat(this.axisFormatY()).ticks(this.height/80)}axisFormatX(){return o.timeFormat("%Y")}axisFormatY(){return a.format("d")}scaleXDomain(){return[this.x(this.data[0]),this.x(this.data[this.data.length-1])]}scaleYDomain(){return e.extent(this.data,this.y)}scaleXRange(){return[this.config.margin.left,this.width-this.config.margin.right]}scaleYRange(){return[this.height-this.config.margin.bottom,this.config.margin.top]}},Object.defineProperty(t,"__esModule",{value:!0})});
